<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶•ì¼ ì•Œë¦¼ ë‹¨í†¡ë°© ë„ìš°ë¯¸</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .input-group {
            @apply flex flex-col sm:flex-row gap-4;
        }
        /* Custom Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
            animation: fadeInScale 0.2s ease-out;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="app" class="w-full max-w-2xl bg-white p-6 md:p-8 rounded-xl shadow-2xl transition-all duration-300">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-2 flex items-center justify-center">
            <svg class="w-8 h-8 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 11a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zm-4-3a5 5 0 100-10 5 5 0 000 10zM2 14a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zm16 0a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.385 5.385a1 1 0 011.415 0l.707.707a1 1 0 01-1.415 1.415l-.707-.707a1 1 0 010-1.415zM15.293 6.707a1 1 0 01-1.415 1.415l-.707-.707a1 1 0 011.415-1.415l.707.707zM10 18a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM6 10a1 1 0 110-2h1a1 1 0 110 2H6zm7 0a1 1 0 110-2h1a1 1 0 110 2h-1z"></path>
            </svg>
            ì¶•ì¼ ì•Œë¦¼ ë„ìš°ë¯¸ (ë°ì´í„° ì €ì¥ë¨)
        </h1>
        <p class="text-center text-xs text-red-500 mb-4" id="user-info"></p>

        <!-- í˜„ì¬ ë‚ ì§œ í‘œì‹œ -->
        <p id="current-date" class="text-center text-gray-500 mb-4 text-sm"></p>
        
        <!-- ì•Œë¦¼ ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="notification-area" class="min-h-[120px] flex flex-col justify-center items-center p-4 rounded-lg bg-gray-50 border border-gray-200 transition-all duration-500 mb-4">
            <p id="status-message" class="text-lg font-semibold text-center text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- ë³µì‚¬ ë²„íŠ¼ (ì¶•ì¼ì´ ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
        <button id="copy-button" class="w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-300 opacity-0 transform translate-y-2 pointer-events-none" style="display: none;" onclick="copyMessage()">
            <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v.75"></path></svg>
            ë‹¨í†¡ë°© ë©”ì‹œì§€ ë³µì‚¬í•˜ê¸°
        </button>

        <!-- ë³µì‚¬ ì™„ë£Œ ë©”ì‹œì§€ -->
        <div id="copy-success" class="mt-4 text-center text-green-600 font-medium opacity-0 transition-opacity duration-300 hidden">
            <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!
        </div>
        
        <!-- ì¶•ì¼ ì…ë ¥ í¼ -->
        <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-xl font-bold text-gray-700 mb-4">â• ìƒˆë¡œìš´ ì¶•ì¼ ë“±ë¡</h3>
            <form id="feast-form" onsubmit="event.preventDefault(); saveFeastDay()">
                <div class="input-group mb-4">
                    <div class="flex-1">
                        <label for="feast-month" class="block text-sm font-medium text-gray-700 mb-1">ì›”</label>
                        <select id="feast-month" required class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 p-2">
                            <!-- 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ ì˜µì…˜ -->
                            <script>
                                for(let i = 1; i <= 12; i++) {
                                    document.write(`<option value="${i}">${i}ì›”</option>`);
                                }
                            </script>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="feast-day" class="block text-sm font-medium text-gray-700 mb-1">ì¼</label>
                        <select id="feast-day" required class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 p-2">
                            <!-- 1ì¼ë¶€í„° 31ì¼ê¹Œì§€ ì˜µì…˜ -->
                            <script>
                                for(let i = 1; i <= 31; i++) {
                                    document.write(`<option value="${i}">${i}ì¼</option>`);
                                }
                            </script>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="feast-name" class="block text-sm font-medium text-gray-700 mb-1">ì¶•ì¼ ì´ë¦„</label>
                    <input type="text" id="feast-name" placeholder="ì˜ˆ: ì„± OOO ê¸°ë…ì¼" required class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 p-2">
                </div>
                
                <div class="mb-4">
                    <label for="feast-message" class="block text-sm font-medium text-gray-700 mb-1">ë‹¨í†¡ë°© ë©”ì‹œì§€ ë‚´ìš©</label>
                    <textarea id="feast-message" rows="3" placeholder="ì˜ˆ: ì˜¤ëŠ˜ì€ ì„± OOO ê¸°ë…ì¼ì…ë‹ˆë‹¤. ì€ì´ ê°€ë“í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”! ğŸ™" required class="w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 p-2"></textarea>
                </div>
                
                <button type="submit" id="save-button" class="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition-colors duration-300 disabled:bg-green-400">
                    ì¶•ì¼ ì €ì¥í•˜ê¸°
                </button>
            </form>
            <p id="save-status" class="text-center mt-2 text-sm text-gray-500 hidden"></p>
        </div>

        <!-- ì €ì¥ëœ ì¶•ì¼ ëª©ë¡ -->
        <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-xl font-bold text-gray-700 mb-4">ğŸ“ ë‚´ê°€ ë“±ë¡í•œ ì¶•ì¼ ëª©ë¡</h3>
            <ul id="custom-feast-list" class="space-y-2">
                <!-- ì‚¬ìš©ì ì§€ì • ì¶•ì¼ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
            <p id="no-custom-feasts" class="text-gray-500 text-center text-sm mt-4 hidden">ë“±ë¡ëœ ì¶•ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        
        <!-- ê°œë°œì ì •ë³´ footer -->
        <div class="mt-10 pt-6 border-t border-gray-200 text-center">
            <p class="text-sm text-gray-500 font-medium">ê°œë°œì: ì„±ì‚°ì„±ë‹¹ ì •ë¯¸ì§„</p>
        </div>

    </div>
    
    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ (Custom Modal) UI -->
    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h4 id="modal-title" class="text-xl font-bold text-gray-800 mb-3">ì•Œë¦¼</h4>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <div id="modal-actions" class="flex justify-end space-x-3">
                <!-- ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- Firebaseì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase ì„¤ì • ë° ë³€ìˆ˜
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // ì „ì—­ ë³€ìˆ˜
        let app, db, auth;
        let userId = null;
        let customFeastDays = []; // Firestoreì—ì„œ ë¶ˆëŸ¬ì˜¨ ì¶•ì¼ ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´
        let isAuthReady = false;

        // HTML ìš”ì†Œ ì„ íƒ
        const notificationArea = document.getElementById('notification-area');
        const statusMessage = document.getElementById('status-message');
        const copyButton = document.getElementById('copy-button');
        const copySuccess = document.getElementById('copy-success');
        const currentDateElem = document.getElementById('current-date');
        const saveButton = document.getElementById('save-button');
        const saveStatus = document.getElementById('save-status');
        const customFeastList = document.getElementById('custom-feast-list');
        const noCustomFeasts = document.getElementById('no-custom-feasts');
        const userInfoElem = document.getElementById('user-info');

        // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalActions = document.getElementById('modal-actions');
        
        // setLogLevel('Debug'); // ë””ë²„ê¹…ìš©: ì½˜ì†”ì— Firebase ë¡œê·¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

        /**
         * Firebaseë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         */
        async function initializeFirebaseAndAuth() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        userInfoElem.textContent = `ì‚¬ìš©ì ID: ${userId} | ë°ì´í„°ëŠ” ì´ IDì— ì €ì¥ë©ë‹ˆë‹¤.`;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        // ì¸ì¦ ì™„ë£Œ í›„ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘
                        setupFeastDayListener();
                    } else {
                        // ì¸ì¦ í† í°ì´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ ì‹œë„, ì—†ìœ¼ë©´ ìµëª… ë¡œê·¸ì¸
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ë˜ëŠ” ì¸ì¦ ì˜¤ë¥˜:", error);
                statusMessage.textContent = 'ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.';
            }
        }

        /**
         * ì‚¬ìš©ì ì§€ì • ì¶•ì¼ì„ ì €ì¥í•˜ëŠ” ì»¬ë ‰ì…˜ ì°¸ì¡°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function getFeastDayCollectionRef() {
            if (!db || !userId) {
                console.error("Database or User ID is not available.");
                return null;
            }
            // ê°œì¸ ë°ì´í„° ê²½ë¡œ: /artifacts/{appId}/users/{userId}/custom_feast_days
            return collection(db, `artifacts/${appId}/users/${userId}/custom_feast_days`);
        }

        /**
         * Firestoreì— ìƒˆë¡œìš´ ì¶•ì¼ì„ ì €ì¥í•©ë‹ˆë‹¤.
         */
        window.saveFeastDay = async function() {
            const month = parseInt(document.getElementById('feast-month').value);
            const day = parseInt(document.getElementById('feast-day').value);
            const name = document.getElementById('feast-name').value.trim();
            const message = document.getElementById('feast-message').value.trim();

            if (!month || !day || !name || !message) {
                showCustomAlert('ì…ë ¥ ì˜¤ë¥˜', 'ëª¨ë“  í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.');
                return;
            }

            const collectionRef = getFeastDayCollectionRef();
            if (!collectionRef) return;

            saveButton.disabled = true;
            saveStatus.textContent = 'ì €ì¥ ì¤‘...';
            saveStatus.classList.remove('hidden');

            try {
                await addDoc(collectionRef, {
                    month: month,
                    day: day,
                    name: name,
                    message: message,
                    createdAt: new Date()
                });

                document.getElementById('feast-form').reset();
                saveStatus.textContent = 'âœ… ì¶•ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
                saveStatus.classList.remove('text-red-500');
                saveStatus.classList.add('text-green-600');
                setTimeout(() => saveStatus.classList.add('hidden'), 3000);

            } catch (e) {
                console.error("ì¶•ì¼ ì €ì¥ ì˜¤ë¥˜:", e);
                saveStatus.textContent = 'âŒ ì €ì¥ ì‹¤íŒ¨: ' + e.message;
                saveStatus.classList.remove('text-green-600');
                saveStatus.classList.add('text-red-500');
            } finally {
                saveButton.disabled = false;
            }
        }
        
        /**
         * ì¶•ì¼ ëª©ë¡ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê³  UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function setupFeastDayListener() {
            if (!isAuthReady || !userId) {
                console.log("Waiting for auth to be ready...");
                return;
            }

            const collectionRef = getFeastDayCollectionRef();
            if (!collectionRef) return;

            onSnapshot(collectionRef, (snapshot) => {
                customFeastDays = [];
                snapshot.forEach(doc => {
                    customFeastDays.push({ id: doc.id, ...doc.data() });
                });
                
                // Firestoreì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¡œ ì¶•ì¼ í™•ì¸ ë° ëª©ë¡ UI ì—…ë°ì´íŠ¸
                checkFeastDay();
                renderFeastList();

                console.log("Feast days updated:", customFeastDays.length);
            }, (error) => {
                console.error("Error setting up Firestore listener:", error);
                statusMessage.textContent = 'ì¶•ì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ.';
            });
        }
        
        /**
         * ì €ì¥ëœ ì¶•ì¼ ëª©ë¡ì„ UIì— í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function renderFeastList() {
            customFeastList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
            
            if (customFeastDays.length === 0) {
                noCustomFeasts.classList.remove('hidden');
                return;
            }
            
            noCustomFeasts.classList.add('hidden');
            
            // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedFeasts = [...customFeastDays].sort((a, b) => {
                if (a.month !== b.month) return a.month - b.month;
                return a.day - b.day;
            });

            sortedFeasts.forEach(feast => {
                const listItem = document.createElement('li');
                listItem.className = 'flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200';
                listItem.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-800">${feast.month}ì›” ${feast.day}ì¼: ${feast.name}</p>
                        <p class="text-xs text-gray-500 truncate max-w-xs sm:max-w-md">${feast.message}</p>
                    </div>
                    <button class="text-red-500 hover:text-red-700 p-1 rounded-full transition-colors" onclick="handleDeleteFeastDay('${feast.id}')" title="ì‚­ì œ">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                `;
                customFeastList.appendChild(listItem);
            });
        }

        /**
         * ì¶•ì¼ ë¬¸ì„œë¥¼ Firestoreì—ì„œ ì‚­ì œí•©ë‹ˆë‹¤. (ì»¤ìŠ¤í…€ confirm ì‚¬ìš©)
         */
        window.handleDeleteFeastDay = function(docId) {
            showCustomConfirm(
                'ì¶•ì¼ ì‚­ì œ í™•ì¸', 
                'ì •ë§ë¡œ ì´ ì¶•ì¼ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 
                async () => {
                    const collectionRef = getFeastDayCollectionRef();
                    if (!collectionRef) return;
                    
                    try {
                        await deleteDoc(doc(collectionRef, docId));
                        // onSnapshot ë¦¬ìŠ¤ë„ˆê°€ ëª©ë¡ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                        showCustomAlert('ì‚­ì œ ì™„ë£Œ', 'ì¶•ì¼ì´ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } catch (e) {
                        console.error("ì¶•ì¼ ì‚­ì œ ì˜¤ë¥˜:", e);
                        showCustomAlert('ì‚­ì œ ì˜¤ë¥˜', 'ì¶•ì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + e.message);
                    }
                }
            );
        }

        /**
         * í˜„ì¬ ë‚ ì§œë¥¼ í™•ì¸í•˜ê³  ì¶•ì¼ì´ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. (Firestore ë°ì´í„° ì‚¬ìš©)
         * 9ì‹œ ì´í›„ë¼ë©´ íŠ¹ë³„ ì•Œë¦¼ì„ ë„ì›ë‹ˆë‹¤.
         */
        function checkFeastDay() {
            const today = new Date();
            const month = today.getMonth() + 1; // getMonth()ëŠ” 0ë¶€í„° ì‹œì‘
            const day = today.getDate();
            const year = today.getFullYear();
            const hour = today.getHours();

            // 9ì‹œ (09:00) ì´í›„ì¸ì§€ í™•ì¸
            const isAfterNineAM = hour >= 9;

            // í˜„ì¬ ë‚ ì§œë¥¼ í•œêµ­ì–´ë¡œ í‘œì‹œ
            currentDateElem.textContent = `${year}ë…„ ${month}ì›” ${day}ì¼ (${isAfterNineAM ? 'ì˜¤ì „ 9ì‹œ ì´í›„' : 'ì˜¤ì „ 9ì‹œ ì´ì „'})`;
            
            // ì˜¤ëŠ˜ ë‚ ì§œì™€ ì¼ì¹˜í•˜ëŠ” ì¶•ì¼ì„ ì°¾ìŠµë‹ˆë‹¤.
            const todayFeast = customFeastDays.find(f => f.month === month && f.day === day);

            if (todayFeast) {
                // ì¶•ì¼ì´ ìˆëŠ” ê²½ìš°
                const chatMessage = `[ì˜¤ëŠ˜ì˜ ì¶•ì¼ ì•Œë¦¼]\n\nğŸ”” ì˜¤ëŠ˜ì€ ${todayFeast.name}ì…ë‹ˆë‹¤.\n\n${todayFeast.message}\n\nğŸ™ ì€ì´ ê°€ë“í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”!`;

                // 9ì‹œ ì´í›„ì—ë§Œ íŠ¹ë³„ ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
                if (isAfterNineAM) {
                    showCustomAlert(
                        'âœ¨ ë‹¨í†¡ë°© ë°œì†¡ ì‹œê°„ì…ë‹ˆë‹¤! âœ¨', 
                        `ì˜¤ëŠ˜ì€ **${todayFeast.name}**ì…ë‹ˆë‹¤. ë©”ì‹œì§€ë¥¼ ë³µì‚¬í•˜ì—¬ ë‹¨í†¡ë°©ì— ë°œì†¡í•´ ì£¼ì„¸ìš”.`,
                        () => window.copyMessage()
                    );
                }


                // ì•Œë¦¼ ì˜ì—­ ì—…ë°ì´íŠ¸ (ë©”ì‹œì§€ ì¹´ë“œ ìŠ¤íƒ€ì¼)
                notificationArea.innerHTML = `
                    <div class="w-full p-4 rounded-lg border-2 border-yellow-400 bg-yellow-50 shadow-lg">
                        <p class="text-xl font-extrabold text-yellow-700 text-center mb-2">ğŸ‰ ${todayFeast.name} ğŸ‰</p>
                        <p class="text-gray-700 whitespace-pre-wrap text-center">${todayFeast.message}</p>
                        ${isAfterNineAM ? '<p class="text-red-500 font-bold mt-2 text-sm">âœ… ì§€ê¸ˆ ë°”ë¡œ ë‹¨í†¡ë°©ì— ë³µì‚¬/ë°œì†¡í•˜ì„¸ìš”!</p>' : '<p class="text-indigo-500 font-medium mt-2 text-sm">ğŸ•˜ ì˜¤ì „ 9ì‹œ ì´í›„ì— ë‹¤ì‹œ ì ‘ì†í•˜ì‹œë©´ ì•Œë¦¼ì´ ëœ¹ë‹ˆë‹¤.</p>'}
                    </div>
                    <textarea id="chat-message-box" class="hidden">${chatMessage}</textarea>
                `;
                
                // ë³µì‚¬ ë²„íŠ¼ í‘œì‹œ ë° ì• ë‹ˆë©”ì´ì…˜
                copyButton.style.display = 'block';
                setTimeout(() => {
                    copyButton.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
                }, 100);

            } else {
                // ì¶•ì¼ì´ ì—†ëŠ” ê²½ìš°
                notificationArea.innerHTML = `
                    <svg class="w-12 h-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    <p class="text-lg font-semibold text-center text-gray-600">ì˜¤ëŠ˜ì€ ë“±ë¡ëœ ì¶•ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p class="text-sm text-gray-500 mt-1">í‰í™”ë¡œìš´ í•˜ë£¨ ë³´ë‚´ì„¸ìš”!</p>
                `;
                
                // ë³µì‚¬ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                copyButton.style.display = 'none';
                copyButton.classList.add('opacity-0', 'translate-y-2', 'pointer-events-none');
            }
        }

        /**
         * ìƒì„±ëœ ë©”ì‹œì§€ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤.
         */
        window.copyMessage = function() {
            const messageBox = document.getElementById('chat-message-box');
            if (!messageBox) return;

            // í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ë³µì‚¬ ëª…ë ¹ ì‹¤í–‰ (iframe í™˜ê²½ì—ì„œ ê¶Œì¥ë˜ëŠ” ë°©ì‹)
            messageBox.select();
            document.execCommand('copy');
            
            // ë³µì‚¬ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
            copySuccess.classList.remove('hidden');
            copySuccess.classList.remove('opacity-0');

            // 3ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                copySuccess.classList.add('opacity-0');
                setTimeout(() => {
                    copySuccess.classList.add('hidden');
                }, 300);
            }, 3000);
        }

        /**
         * ì‚¬ìš©ì ì§€ì • Alert ëª¨ë‹¬ì„ í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {string} title - ëª¨ë‹¬ ì œëª©
         * @param {string} message - ëª¨ë‹¬ ë©”ì‹œì§€ (HTML í¬í•¨ ê°€ëŠ¥)
         * @param {function} [onConfirm=null] - í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰í•  í•¨ìˆ˜
         */
        function showCustomAlert(title, message, onConfirm = null) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            modalActions.innerHTML = '';

            const okButton = document.createElement('button');
            okButton.textContent = onConfirm ? 'ë³µì‚¬í•˜ê³  í™•ì¸' : 'í™•ì¸';
            okButton.className = 'py-2 px-4 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors';
            okButton.onclick = () => {
                customModal.classList.add('hidden');
                if (onConfirm) onConfirm();
            };
            modalActions.appendChild(okButton);
            customModal.classList.remove('hidden');
        }

        /**
         * ì‚¬ìš©ì ì§€ì • Confirm ëª¨ë‹¬ì„ í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {string} title - ëª¨ë‹¬ ì œëª©
         * @param {string} message - ëª¨ë‹¬ ë©”ì‹œì§€
         * @param {function} onConfirmed - 'ì˜ˆ' ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰í•  í•¨ìˆ˜
         */
        function showCustomConfirm(title, message, onConfirmed) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalActions.innerHTML = '';

            // ì·¨ì†Œ ë²„íŠ¼
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'ì·¨ì†Œ';
            cancelButton.className = 'py-2 px-4 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors';
            cancelButton.onclick = () => customModal.classList.add('hidden');
            modalActions.appendChild(cancelButton);

            // í™•ì¸ ë²„íŠ¼
            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'ì˜ˆ, ì‚­ì œí•©ë‹ˆë‹¤';
            confirmButton.className = 'py-2 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors';
            confirmButton.onclick = () => {
                customModal.classList.add('hidden');
                onConfirmed();
            };
            modalActions.appendChild(confirmButton);

            customModal.classList.remove('hidden');
        }

        // ì•± ë¡œë“œ ì‹œ Firebase ì´ˆê¸°í™” ë° ì¸ì¦ ì‹œì‘
        window.onload = initializeFirebaseAndAuth;

    </script>
</body>
</html>
